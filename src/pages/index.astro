---
/// <reference types="astro/astro-jsx" />
import DefaultLayout from '../layouts/DefaultLayout.astro'
import Hero from '../components/Hero.astro'
import ContentMedia from '../components/ContentMedia.astro'
import ContentImage from '../components/ContentImage.astro'
import { getBlogPosts } from '../components/BlogCollection.astro'

const posts = await getBlogPosts()

const latestPosts = posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()).slice(0, 5)
---

<DefaultLayout title="Home">
  <Hero />

  <section class="home-section" aria-label="Our Origin">
    <div class="container">
      <ContentMedia
        imgSrc="https://res.cloudinary.com/dxwistw0r/image/upload/v1738302326/landing-image_xfzb72.png"
        imgAlt="A little illustration of a fun little guy"
        imgSide="right"
        imgHeight={3049}
        imgWidth={1943}
      >
        <h2 class="text-4xl italic">Hi there!</h2>
        <p class="text-xl md:text-2xl">
          We're Skyborn Studios, a small team of passionate game developers from Sacramento, CA.
        </p>
        <p class="text-xl md:text-2xl">
          We're building the games for the love of it, telling stories we want to tell. We're not here to make a quick
          buck, we're here to make games that we want to play.
        </p>
        <p class="text-xl md:text-2xl">
          Follow along as we build our first game, <a href="/games/cirrus" class="italic">Cirrus</a>.
        </p>
      </ContentMedia>
    </div>
  </section>

  <section class="home-section" aria-label="Join Our Journey">
    <div class="container text-center">
      <h2 class="text-4xl">Join Our Journey</h2>
      <p class="mx-auto mt-8 max-w-[32rem] text-left text-xl md:text-center md:text-2xl">
        We're building in the open! Come read our development log if you're curious about how we're building Cirrus ðŸ˜Š
      </p>
      <p class="mx-auto mt-8 max-w-[32rem] text-left text-xl md:text-center md:text-2xl">
        We've got a community Discord in the works, but it's not ready yet. Come back soon to check when it's ready!
      </p>
      <div class="mt-12 flex justify-center gap-6">
        <!-- <a href="/discord" class="button button-ghost flex items-center gap-3">
          <span class="i-mdi-discord text-2xl"></span>
          Discord Community
        </a> -->
        <a href="/blog" aria-label="Development Blog" class="button"> View Development Blog </a>
      </div>
    </div>
  </section>

  <section class="home-section">
    <div class="container">
      <h2 class="mb-16 text-center text-4xl">Development Blog</h2>
      <p id="blog-description" class="mb-16 text-xl md:text-2xl">
        This is a list of our latest blog posts. We'll be posting updates on our development progress here, feel free to
        read along!
      </p>
      <div id="blog-grid" class="grid grid-cols-1 gap-12 sm:grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
        {
          latestPosts.map((post) => {
            return (
              <div class="space-content post-item hidden">
                <ContentImage imgSrc={post.data.thumbnail} alt="Blog post thumbnail" />
                <h3 class="text-2xl">{post.data.title}</h3>
                <p class="break-words">{post.data.excerpt}</p>
                <a href={`/blog/${post.slug}`} class="button button-ghost mt-4">
                  Read More
                </a>
              </div>
            )
          })
        }
      </div>
    </div>
  </section>
</DefaultLayout>

<script>
  function updateVisiblePosts() {
    const grid = document.getElementById('blog-grid')
    if (!grid) return
    const posts = grid.querySelectorAll('.post-item')
    const computedStyle = window.getComputedStyle(grid)
    const columns = computedStyle.gridTemplateColumns.split(' ').length

    posts.forEach((post, index) => {
      if (index < columns) {
        post.classList.remove('hidden')
      } else {
        post.classList.add('hidden')
      }
    })
  }

  window.addEventListener('resize', updateVisiblePosts)
  window.addEventListener('load', updateVisiblePosts)
</script>

<style>
  .home-section {
    margin: 8rem auto;
    max-width: var(--layout-max-width);
  }
  #blog-description {
    max-width: var(--content-max-width);
  }
</style>
